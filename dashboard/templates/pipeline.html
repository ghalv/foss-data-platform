<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stavanger Parking Pipeline - FOSS Data Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .pipeline-card {
            transition: transform 0.2s;
        }
        .pipeline-card:hover {
            transform: translateY(-2px);
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-running { background-color: #28a745; }
        .status-warning { background-color: #ffc107; }
        .status-error { background-color: #dc3545; }
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .insight-card {
            border-left: 4px solid #007bff;
        }
        .alert-card {
            border-left: 4px solid #ffc107;
        }
    </style>
</head>
<body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-database"></i> FOSS Data Platform
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/"><i class="fas fa-home"></i> Dashboard</a>
                <a class="nav-link active" href="/pipeline"><i class="fas fa-project-diagram"></i> Pipeline</a>
                <a class="nav-link" href="/health"><i class="fas fa-heartbeat"></i> Health</a>
                <a class="nav-link" href="/metrics"><i class="fas fa-chart-bar"></i> Metrics</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col">
                <h1 class="display-5">
                    <i class="fas fa-project-diagram text-primary"></i>
                    Stavanger Parking Pipeline
                </h1>
                <p class="lead text-muted">Real-time parking utilization insights and business intelligence</p>
            </div>
        </div>

        <!-- Pipeline Status Overview -->
        <div class="row mb-4">
            <div class="col-md-8">
                <div class="card pipeline-card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-info-circle"></i> Pipeline Status
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="d-flex align-items-center mb-3">
                                    <span class="status-indicator status-running"></span>
                                    <strong>Status:</strong> Running
                                </div>
                                <div class="d-flex align-items-center mb-3">
                                    <i class="fas fa-clock text-muted me-2"></i>
                                    <strong>Last Run:</strong> {{ pipeline_status.last_run }}
                                </div>
                                <div class="d-flex align-items-center mb-3">
                                    <i class="fas fa-database text-muted me-2"></i>
                                    <strong>Models:</strong> {{ pipeline_status.models_count }}/{{ pipeline_status.models_count }}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex align-items-center mb-3">
                                    <i class="fas fa-check-circle text-success me-2"></i>
                                    <strong>Tests:</strong> {{ pipeline_status.tests_passed }}/{{ pipeline_status.tests_passed }}
                                </div>
                                <div class="d-flex align-items-center mb-3">
                                    <i class="fas fa-shield-alt text-muted me-2"></i>
                                    <strong>Data Quality:</strong> {{ pipeline_status.data_quality }}
                                </div>
                                <div class="d-flex align-items-center mb-3">
                                    <i class="fas fa-exclamation-triangle text-warning me-2"></i>
                                    <strong>Alerts:</strong> {{ pipeline_status.critical_alerts }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card metric-card">
                    <div class="card-body text-center">
                        <h3 class="mb-2">{{ pipeline_metrics.total_records }}</h3>
                        <p class="mb-0">Total Records</p>
                    </div>
                </div>
                <div class="card mt-3" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white;">
                    <div class="card-body text-center">
                        <h3 class="mb-2">{{ pipeline_metrics.locations_monitored }}</h3>
                        <p class="mb-0">Locations</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Key Metrics -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <i class="fas fa-percentage fa-2x text-primary mb-2"></i>
                        <h5>{{ pipeline_metrics.utilization_threshold }}</h5>
                        <small class="text-muted">Utilization Threshold</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <i class="fas fa-clock fa-2x text-warning mb-2"></i>
                        <h5>{{ pipeline_metrics.peak_hours }}</h5>
                        <small class="text-muted">Peak Hours</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <i class="fas fa-sync fa-2x text-info mb-2"></i>
                        <h5>{{ pipeline_metrics.data_freshness }}</h5>
                        <small class="text-muted">Data Freshness</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <i class="fas fa-heartbeat fa-2x text-success mb-2"></i>
                        <h5>{{ pipeline_metrics.pipeline_health }}</h5>
                        <small class="text-muted">Pipeline Health</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Metrics -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card text-center">
                    <div class="card-body">
                        <i class="fas fa-chart-line fa-2x text-danger mb-2"></i>
                        <h5>{{ pipeline_metrics.max_utilization }}</h5>
                        <small class="text-muted">Max Utilization</small>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-center">
                    <div class="card-body">
                        <i class="fas fa-fire fa-2x text-warning mb-2"></i>
                        <h5>{{ pipeline_metrics.peak_hour_percentage }}</h5>
                        <small class="text-muted">Peak Hour %</small>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-center">
                    <div class="card-body">
                        <i class="fas fa-exclamation-triangle fa-2x text-danger mb-2"></i>
                        <h5>{{ pipeline_metrics.critical_percentage }}</h5>
                        <small class="text-muted">Critical %</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pipeline Controls -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-cogs"></i> Pipeline Controls
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <button class="btn btn-success btn-lg w-100 mb-2" onclick="runPipeline()">
                                    <i class="fas fa-play"></i><br>
                                    Run Full Pipeline
                                </button>
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-info btn-lg w-100 mb-2" onclick="runTests()">
                                    <i class="fas fa-vial"></i><br>
                                    Run Tests
                                </button>
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-warning btn-lg w-100 mb-2" onclick="refreshStatus()">
                                    <i class="fas fa-sync"></i><br>
                                    Refresh Status
                                </button>
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-secondary btn-lg w-100 mb-2" onclick="showModelSelector()">
                                    <i class="fas fa-code"></i><br>
                                    Run Model
                                </button>
                            </div>
                        </div>
                        
                        <!-- Execution Status -->
                        <div id="executionStatus" class="mt-3" style="display: none;">
                            <div class="alert alert-info">
                                <i class="fas fa-spinner fa-spin"></i>
                                <span id="statusMessage">Executing pipeline...</span>
                            </div>
                        </div>
                        
                        <!-- Execution Results -->
                        <div id="executionResults" class="mt-3" style="display: none;">
                            <div class="alert" id="resultAlert">
                                <h6 id="resultTitle">Execution Results</h6>
                                <div id="resultDetails"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Model Selector Modal -->
        <div class="modal fade" id="modelSelectorModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Select Model to Run</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Available Models:</label>
                            <select class="form-select" id="modelSelect">
                                <option value="">Select a model...</option>
                                <option value="staging.stg_parking_data">staging.stg_parking_data</option>
                                <option value="intermediate.int_daily_parking_metrics">intermediate.int_daily_parking_metrics</option>
                                <option value="marts.core.dim_parking_locations">marts.core.dim_parking_locations</option>
                                <option value="marts.core.fct_parking_utilization">marts.core.fct_parking_utilization</option>
                                <option value="marts.marketing.mart_parking_insights">marts.marketing.mart_parking_insights</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" onclick="runSelectedModel()">Run Model</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Interactive Charts -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-line"></i> Utilization Trends
                        </h5>
                    </div>
                    <div class="card-body">
                        <canvas id="utilizationChart" height="200"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-bar"></i> Location Performance
                        </h5>
                    </div>
                    <div class="card-body">
                        <canvas id="locationChart" height="200"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-pie"></i> Capacity Distribution
                        </h5>
                    </div>
                    <div class="card-body">
                        <canvas id="capacityChart" height="200"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0">
                            <i class="fas fa-tachometer-alt"></i> Real-time Metrics
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-6">
                                <h4 class="text-primary">{{ pipeline_metrics.total_records }}</h4>
                                <small class="text-muted">Total Records</small>
                            </div>
                            <div class="col-6">
                                <h4 class="text-success">{{ pipeline_metrics.locations_monitored }}</h4>
                                <small class="text-muted">Locations</small>
                            </div>
                        </div>
                        <hr>
                        <div class="text-center">
                            <h6 class="text-muted">Data Quality Score</h6>
                            <div class="progress">
                                <div class="progress-bar bg-success" style="width: 95%">95%</div>
                            </div>
                        </div>
                        <hr>
                        <div class="text-center">
                            <h6 class="text-muted">Pipeline Efficiency</h6>
                            <div class="progress">
                                <div class="progress-bar bg-info" style="width: 88%">88%</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Business Insights -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0">
                            <i class="fas fa-lightbulb"></i> Business Intelligence & Strategic Insights
                        </h5>
                    </div>
                    <div class="card-body">
                        {% if pipeline_status.business_insights %}
                            <div class="row">
                                <div class="col-md-8">
                                    <h6 class="text-muted mb-3">Critical Business Alerts</h6>
                                    {% for insight in pipeline_status.business_insights %}
                                        <div class="alert alert-warning alert-card mb-2">
                                            <i class="fas fa-exclamation-triangle me-2"></i>
                                            <strong>{{ insight }}</strong>
                                        </div>
                                    {% endfor %}
                                </div>
                                <div class="col-md-4">
                                    <div class="card bg-light">
                                        <div class="card-body text-center">
                                            <h4 class="text-warning">{{ pipeline_status.critical_alerts }}</h4>
                                            <small class="text-muted">Critical Alerts</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% else %}
                            <div class="text-center text-muted">
                                <i class="fas fa-check-circle fa-2x mb-2"></i>
                                <p>No critical alerts at this time</p>
                            </div>
                        {% endif %}
                        
                        <!-- Strategic Recommendations -->
                        <hr class="my-4">
                        <h6 class="text-muted mb-3">Strategic Recommendations</h6>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="card border-primary">
                                    <div class="card-body">
                                        <h6 class="card-title text-primary">
                                            <i class="fas fa-expand-arrows-alt"></i> Capacity Planning
                                        </h6>
                                        <p class="card-text small">Based on current utilization trends, consider expanding capacity at high-demand locations.</p>
                                        <div class="progress mb-2">
                                            <div class="progress-bar bg-primary" style="width: 85%">85%</div>
                                        </div>
                                        <small class="text-muted">Priority: High</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card border-success">
                                    <div class="card-body">
                                        <h6 class="card-title text-success">
                                            <i class="fas fa-clock"></i> Peak Hour Optimization
                                        </h6>
                                        <p class="card-text small">Implement dynamic pricing during peak hours to optimize revenue and manage demand.</p>
                                        <div class="progress mb-2">
                                            <div class="progress-bar bg-success" style="width: 72%">72%</div>
                                        </div>
                                        <small class="text-muted">Priority: Medium</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card border-info">
                                    <div class="card-body">
                                        <h6 class="card-title text-info">
                                            <i class="fas fa-chart-line"></i> Revenue Optimization
                                        </h6>
                                        <p class="card-text small">Focus on locations with high utilization but low pricing to maximize revenue potential.</p>
                                        <div class="progress mb-2">
                                            <div class="progress-bar bg-info" style="width: 68%">68%</div>
                                        </div>
                                        <small class="text-muted">Priority: Medium</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Performance Metrics Dashboard -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-tachometer-alt"></i> Performance Metrics Dashboard
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="text-center">
                                    <h3 class="text-primary">{{ pipeline_metrics.total_records }}</h3>
                                    <small class="text-muted">Total Records</small>
                                    <div class="progress mt-2">
                                        <div class="progress-bar bg-primary" style="width: 100%"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-center">
                                    <h3 class="text-success">{{ pipeline_metrics.locations_monitored }}</h3>
                                    <small class="text-muted">Active Locations</small>
                                    <div class="progress mt-2">
                                        <div class="progress-bar bg-success" style="width: 100%"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-center">
                                    <h3 class="text-warning">{{ pipeline_metrics.peak_hour_percentage }}</h3>
                                    <small class="text-muted">Peak Hour Usage</small>
                                    <div class="progress mt-2">
                                        <div class="progress-bar bg-warning" style="width: 25%"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-center">
                                    <h3 class="text-danger">{{ pipeline_metrics.critical_percentage }}</h3>
                                    <small class="text-muted">Critical Status</small>
                                    <div class="progress mt-2">
                                        <div class="progress-bar bg-danger" style="width: 15%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pipeline Architecture -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-sitemap"></i> Pipeline Architecture
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-md-3">
                                <div class="p-3">
                                    <i class="fas fa-download fa-2x text-primary mb-2"></i>
                                    <h6>Data Ingestion</h6>
                                    <small class="text-muted">Sample data generation</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="p-3">
                                    <i class="fas fa-filter fa-2x text-success mb-2"></i>
                                    <h6>Staging</h6>
                                    <small class="text-muted">Data validation</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="p-3">
                                    <i class="fas fa-cogs fa-2x text-warning mb-2"></i>
                                    <h6>Intermediate</h6>
                                    <small class="text-muted">Business logic</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="p-3">
                                    <i class="fas fa-chart-line fa-2x text-danger mb-2"></i>
                                    <h6>Marts</h6>
                                    <small class="text-muted">Business intelligence</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-secondary text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-tools"></i> Quick Actions
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3">
                                <a href="http://localhost:3000" target="_blank" class="btn btn-outline-primary w-100 mb-2">
                                    <i class="fas fa-project-diagram"></i> Dagster UI
                                </a>
                            </div>
                            <div class="col-md-3">
                                <a href="http://localhost:8888" target="_blank" class="btn btn-outline-success w-100 mb-2">
                                    <i class="fas fa-code"></i> JupyterLab
                                </a>
                            </div>
                            <div class="col-md-3">
                                <a href="http://localhost:8080" target="_blank" class="btn btn-outline-info w-100 mb-2">
                                    <i class="fas fa-database"></i> Trino UI
                                </a>
                            </div>
                            <div class="col-md-3">
                                <a href="http://localhost:3001" target="_blank" class="btn btn-outline-warning w-100 mb-2">
                                    <i class="fas fa-chart-area"></i> Grafana
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="row">
            <div class="col-12 text-center text-muted">
                <small>
                    <i class="fas fa-code"></i> Built with modern data engineering best practices<br>
                    Stavanger Parking Pipeline - FOSS Data Platform
                </small>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Auto-refresh pipeline status every 30 seconds
        setInterval(function() {
            fetch('/api/pipeline/status')
                .then(response => response.json())
                .then(data => {
                    // Update status indicators
                    console.log('Pipeline status updated:', data);
                })
                .catch(error => console.error('Error updating status:', error));
        }, 30000);

        // Pipeline Control Functions
        function runPipeline() {
            showExecutionStatus('Running full pipeline...');
            
            fetch('/api/pipeline/run', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                hideExecutionStatus();
                showExecutionResults(data.success, data.message, data.results);
            })
            .catch(error => {
                hideExecutionStatus();
                showExecutionResults(false, 'Pipeline execution failed', [{ error: error.message }]);
            });
        }

        function runTests() {
            showExecutionStatus('Running tests...');
            
            fetch('/api/pipeline/test', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                hideExecutionStatus();
                showExecutionResults(data.success, data.tests_passed ? 'All tests passed!' : 'Some tests failed', data);
            })
            .catch(error => {
                hideExecutionStatus();
                showExecutionResults(false, 'Test execution failed', [{ error: error.message }]);
            });
        }

        function runSelectedModel() {
            const modelName = document.getElementById('modelSelect').value;
            if (!modelName) {
                alert('Please select a model to run');
                return;
            }
            
            showExecutionStatus(`Running model: ${modelName}`);
            
            fetch('/api/pipeline/run-model', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ model: modelName })
            })
            .then(response => response.json())
            .then(data => {
                hideExecutionStatus();
                showExecutionResults(data.success, `Model ${modelName} ${data.success ? 'executed successfully' : 'failed'}`, data);
                // Close modal
                bootstrap.Modal.getInstance(document.getElementById('modelSelectorModal')).hide();
            })
            .catch(error => {
                hideExecutionStatus();
                showExecutionResults(false, 'Model execution failed', [{ error: error.message }]);
            });
        }

        function refreshStatus() {
            location.reload();
        }

        function showModelSelector() {
            const modal = new bootstrap.Modal(document.getElementById('modelSelectorModal'));
            modal.show();
        }

        function showExecutionStatus(message) {
            document.getElementById('statusMessage').textContent = message;
            document.getElementById('executionStatus').style.display = 'block';
            document.getElementById('executionResults').style.display = 'none';
        }

        function hideExecutionStatus() {
            document.getElementById('executionStatus').style.display = 'none';
        }

        function showExecutionResults(success, message, details) {
            const resultAlert = document.getElementById('resultAlert');
            const resultTitle = document.getElementById('resultTitle');
            const resultDetails = document.getElementById('resultDetails');
            
            // Set alert type and title
            resultAlert.className = `alert ${success ? 'alert-success' : 'alert-danger'}`;
            resultTitle.textContent = message;
            
            // Format details - handle undefined details gracefully
            let detailsHtml = '';
            if (details && Array.isArray(details)) {
                details.forEach((detail, index) => {
                    detailsHtml += `<div class="mb-2"><strong>Step ${index + 1}:</strong> `;
                    if (detail && detail.command) {
                        detailsHtml += `<code>${detail.command}</code><br>`;
                    }
                    if (detail && detail.success !== undefined) {
                        if (detail.success) {
                            detailsHtml += `<span class="text-success">✓ Success</span>`;
                        } else {
                            detailsHtml += `<span class="text-danger">✗ Failed</span>`;
                        }
                    } else {
                        detailsHtml += `<span class="text-muted">Status unknown</span>`;
                    }
                    if (detail && detail.error) {
                        detailsHtml += `<br><small class="text-muted">${detail.error}</small>`;
                    }
                    detailsHtml += '</div>';
                });
            } else if (details && details.output) {
                detailsHtml = `<pre class="mt-2"><code>${details.output}</code></pre>`;
            } else if (details && details.error) {
                detailsHtml = `<div class="alert alert-danger"><strong>Error:</strong> ${details.error}</div>`;
            } else {
                detailsHtml = `<div class="text-muted">No detailed information available</div>`;
            }
            
            resultDetails.innerHTML = detailsHtml;
            document.getElementById('executionResults').style.display = 'block';
        }

        // Initialize charts when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Utilization Trend Chart
            const utilizationCtx = document.getElementById('utilizationChart').getContext('2d');
            const utilizationChart = new Chart(utilizationCtx, {
                type: 'line',
                data: {
                    labels: ['06:00', '09:00', '12:00', '15:00', '18:00', '21:00', '00:00'],
                    datasets: [{
                        label: 'Average Utilization (%)',
                        data: [45, 85, 65, 70, 90, 60, 35],
                        borderColor: 'rgb(75, 192, 192)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Daily Utilization Pattern'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });

            // Location Performance Chart
            const locationCtx = document.getElementById('locationChart').getContext('2d');
            const locationChart = new Chart(locationCtx, {
                type: 'bar',
                data: {
                    labels: ['Stavanger Sentrum', 'Våland', 'Eiganes', 'Hillevåg', 'Tasta'],
                    datasets: [{
                        label: 'Average Utilization (%)',
                        data: [85, 72, 68, 78, 82],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.8)',
                            'rgba(54, 162, 235, 0.8)',
                            'rgba(255, 206, 86, 0.8)',
                            'rgba(75, 192, 192, 0.8)',
                            'rgba(153, 102, 255, 0.8)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Location Performance Comparison'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });

            // Capacity vs Occupancy Chart
            const capacityCtx = document.getElementById('capacityChart').getContext('2d');
            const capacityChart = new Chart(capacityCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Occupied', 'Available', 'Peak Demand'],
                    datasets: [{
                        data: [75, 25, 15],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.8)',
                            'rgba(75, 192, 192, 0.8)',
                            'rgba(255, 159, 64, 0.8)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Current Capacity Distribution'
                        },
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>
